<!DOCTYPE html><html><head><title>-Battleship Earth Simulator-</title>
<style>body{margin:0;background-color:#000}canvas{position:absolute}#bg1{background-image:radial-gradient(ellipse farthest-corner at center top,#23233f 0%,#000 60%)}.bigger{font-size:40px}.menu-message{text-align:center;position:absolute;display:block;width:100%;top:40%;font-family:Arial;font-size:44px;font-weight:600;color:#fff;text-transform:uppercase;letter-spacing:4px;margin:0 0 4px}#Lose-message{color:red;font-size:80px}#credits{margin:40px 0 4px;font-family:Arial;font-size:11px;font-weight:400;text-transform:uppercase;color:#0ff;letter-spacing:2px}#message{color:#fff;position:absolute;font-size:20px;font-weight:700;width:15%;height:5%;right:.5%;top:.87%;opacity:.5;text-align:center;background-color:rgba(30,30,30,1);border:5px solid #888;border-radius:5px;display:none}#story{position:absolute;width:60%;top:20%;left:20%;margin:0 20px 0 0}#story,#savedMessage{font-family:Arial;font-size:16px;font-weight:400;text-transform:uppercase;color:#0ff;letter-spacing:2px}#savedMessage{display:inline-block}#enemy1{right:.5%;top:.87%}#destinyDisplay{left:30%;top:30%}#destinyDisplay,#issueMessage{position:absolute;display:'block'}#issueMessage{left:40%;top:40%;width:365px}#weaponDisplay{left:20px;top:175px}#weaponDisplay,#planetDisplay{position:absolute;width:375px;display:'block'}#planetDisplay{left:435px;top:40px}.weapon-name{font-size:24px;font-weight:600;letter-spacing:4px;margin:0 0 4px}.weapon-name,.choiceTitle{font-family:Arial;color:#fff;text-transform:uppercase}.choiceTitle{font-size:19px;font-weight:800;letter-spacing:2px}.info{width:300px;border-radius:5px;overflow:hidden;background:#3C3B3D;padding:20px 20px 25px;line-height:1.75em}.weapon-details-titles{font-family:Arial;font-size:16px;font-weight:400;text-transform:uppercase;color:gray;letter-spacing:2px;margin:0 20px 0 0}.w-dets-numbers,.w-dets-pop{font-family:Arial;font-size:14px;font-weight:400;text-transform:lowercase;color:#ff0;letter-spacing:2px}.sLine{display:inline-block}.destinyinfo{width:550px;border-radius:5px;overflow:hidden;background:#3C3B3D;padding:20px 20px 25px}.destiny-details{font-family:Arial;font-size:10px;font-weight:200;text-transform:uppercase;color:gray;letter-spacing:1px;line-height:1.75em;vertical-align:text-top;text-align:justify}.inLine{width:30%;display:inline-block;padding:10px 15px 0 0}.next-tab{float:right;text-align:center;overflow:hidden;background:#626164;margin:0 40px 0 0}.next-tab,.previous-tab{border-radius:0 0 10px 10px;width:120px;padding:5px 0 0}.previous-tab{float:left;margin:0 0 0 5px}.previous-tab,.close-tab{text-align:center;overflow:hidden;background:#626164}.close-tab{float:right;width:35px;margin:5px 0 0}.close-tab,button{border-radius:0 10px 10px 0}button{background:#000;background:linear-gradient(#999,#282828);font-size:16px;font-weight:400;cursor:pointer;border:0;color:#ccc;margin:0 .3em;padding:2px 8px;text-shadow:0 3px 2px rgba(0,0,0,.95)}button:hover{text-shadow:0 0 20px #fff,0 0 15px #fff,0 0 10px #fff}button:active{text-shadow:0 0 30px #fff,0 0 20px #fff,0 0 10px #fff;top:1px;background:linear-gradient(#282828,#999);text-shadow:0 2px 2px rgba(0,0,0,.5)}button:focus{outline:none}.longerButton{padding:2px 50px}.fatterButton{padding:15px 13px}</style></head><body>
<script>var $ = {};$.weaponMenu=function(){this.currWeapon=1,this.weapons=[],this.replacementWeapon,$.weaponMenu.Box=document.getElementById("weaponDisplay"),$.weaponMenu.Slot=document.getElementById("wSlot"),$.weaponMenu.Damage=document.getElementById("wDamage"),$.weaponMenu.Health=document.getElementById("wHealth"),$.weaponMenu.FireRate=document.getElementById("wFireRate"),$.weaponMenu.Accuracy=document.getElementById("wAccuracy"),$.weaponMenu.Element=document.getElementById("wElement"),$.weaponMenu.ElementCost=document.getElementById("wEleCost"),$.weaponMenu.Prev=document.getElementById("wPrev"),$.weaponMenu.Next=document.getElementById("wNext"),$.weaponMenu.Replace=document.getElementById("wReplace")},$.weaponMenu.prototype.ClickPrevNext=function(e){this.currWeapon+=e,this.showWeapon()},$.weaponMenu.prototype.showWeapon=function(){$.weaponMenu.Slot.innerText=this.currWeapon,$.weaponMenu.Damage.innerText=Math.round(this.weapons[this.currWeapon-1].damage),$.weaponMenu.Health.innerText=Math.round(this.weapons[this.currWeapon-1].maxHealth),$.weaponMenu.FireRate.innerText=Math.round(this.weapons[this.currWeapon-1].fireRate/60)+"s",$.weaponMenu.Accuracy.innerText=Math.round(100*this.weapons[this.currWeapon-1].accuracy)+"%",$.weaponMenu.Element.innerText=this.weapons[this.currWeapon-1].elementType,$.weaponMenu.ElementCost.innerText=this.weapons[this.currWeapon-1].elementCost,$.weaponMenu.Prev.disabled=1==this.currWeapon?!0:!1,$.weaponMenu.Next.disabled=this.currWeapon==this.weapons.length?!0:!1,$.weaponMenu.Prev.style.display=1==this.currWeapon?"none":"block",$.weaponMenu.Next.style.display=this.currWeapon==this.weapons.length?"none":"block"},$.weaponMenu.prototype.hide=function(){$.weaponMenu.Box.style.display="none","weaponDecision"==$.gameState&&($.peace(),$.issueDisplay.hide())},$.weaponMenu.prototype.crushEm=function(){this.weapons[this.currWeapon-1].damage=1e5,$.weaponMenu.Damage.innerText=Math.round(this.weapons[this.currWeapon-1].damage)},$.weaponMenu.prototype.delete=function(){$.weaponMenu.Replace.style.display="none",this.replacementWeapon.health=1,this.replacementWeapon.isCpu=!1,this.weapons[this.currWeapon-1]=this.replacementWeapon,this.showWeapon(),$.weaponButtons=[];for(var e,t=0;t<$.player.weaponSlots;)e=t<$.player.weapons.length?$.player.weapons[t]:{health:0,isCpu:this.isCpu,elementType:""},$.weaponButtons.push(new $.weaponButton(30*(t+1),160,e)),t++;"weaponDecision"==$.gameState&&($.peace(),$.issueDisplay.hide())},$.weaponMenu.prototype.show=function(e,t,a){$.weaponMenu.Replace.style.display=null!=a?"block":"none",this.replacementWeapon=a||null,this.weapons=e||$.player.weapons,this.currWeapon=t||1,this.ClickPrevNext(0),$.weaponMenu.Box.style.display="block"},$.planetMenu=function(){$.planetMenu.Box=document.getElementById("planetDisplay"),$.planetMenu.weaponSlots=document.getElementById("pSlots"),$.planetMenu.openSlots=document.getElementById("pOpenSlots"),$.planetMenu.population=document.getElementById("pPopulation"),$.planetMenu.Health=document.getElementById("health"),$.planetMenu.Water=document.getElementById("water"),$.planetMenu.Fire=document.getElementById("fire"),$.planetMenu.Air=document.getElementById("air"),$.planetMenu.Healthtext=document.getElementById("healthpercent"),$.planetMenu.Watertext=document.getElementById("waterpercent"),$.planetMenu.Firetext=document.getElementById("firepercent"),$.planetMenu.Airtext=document.getElementById("airpercent"),$.planetMenu.Populationtext=document.getElementById("populationpercent")},$.planetMenu.prototype.hide=function(){$.planetMenu.Box.style.display="none"},$.planetMenu.prototype.show=function(){$.planetMenu.Box.style.display="block",this.setValues($.player.elementsPopulation,$.player.population,$.player.weaponSlots,$.player.weaponSlots-$.player.weapons.length)},$.planetMenu.prototype.setValues=function(e,t,a,n){$.planetMenu.population.innerText=t,$.planetMenu.weaponSlots.innerText=a,$.planetMenu.openSlots.innerText=n,$.planetMenu.Health.value=e.health,$.planetMenu.Water.value=e.water,$.planetMenu.Fire.value=e.fire,$.planetMenu.Air.value=e.air,$.planetMenu.Populationtext.innerText=parseInt(e.health)+parseInt(e.water)+parseInt(e.fire)+parseInt(e.air)+"%",$.planetMenu.Healthtext.innerText=$.planetMenu.Health.value+"%",$.planetMenu.Watertext.innerText=$.planetMenu.Water.value+"%",$.planetMenu.Firetext.innerText=$.planetMenu.Fire.value+"%",$.planetMenu.Airtext.innerText=$.planetMenu.Air.value+"%"},$.planetMenu.prototype.updatePercents=function(e){var t=parseInt($.planetMenu.Health.value)+parseInt($.planetMenu.Water.value)+parseInt($.planetMenu.Fire.value)+parseInt($.planetMenu.Air.value);t>100&&(e.value=parseInt(e.value)-(t-100)),$.planetMenu.Healthtext.innerText=$.planetMenu.Health.value+"%",$.planetMenu.Watertext.innerText=$.planetMenu.Water.value+"%",$.planetMenu.Firetext.innerText=$.planetMenu.Fire.value+"%",$.planetMenu.Airtext.innerText=$.planetMenu.Air.value+"%",$.planetMenu.Populationtext.innerText=Math.min(parseInt(t),100)+"%",$.player.elementsPopulation.health=$.planetMenu.Health.value,$.player.elementsPopulation.water=$.planetMenu.Water.value,$.player.elementsPopulation.fire=$.planetMenu.Fire.value,$.player.elementsPopulation.air=$.planetMenu.Air.value},$.destinyMenu=function(){$.destinyMenu.Box=document.getElementById("destinyDisplay")},$.destinyMenu.prototype.destroyClick=function(){var e=$.player.destroyPlanet();e?$.peace():($.gameState="weaponDecision",$.issueDisplay.show()),$.destinyMenu.Box.style.display="none"},$.destinyMenu.prototype.peaceClick=function(){$.player.declarePeace(),$.peace(),$.destinyMenu.Box.style.display="none"},$.destinyMenu.prototype.takeoverClick=function(){$.player.takeoverPlanet(),$.peace(),$.destinyMenu.Box.style.display="none"},$.destinyMenu.prototype.show=function(){$.destinyMenu.Box.style.display="block",$.weaponDisplay.hide(),$.planetDisplay.hide()},$.destinyMenu.prototype.hide=function(){$.destinyMenu.Box.style.display="none"},$.issueMenu=function(){$.issueMenu.Box=document.getElementById("issueMessage")},$.issueMenu.prototype.show=function(){$.issueMenu.Box.style.display="block"},$.issueMenu.prototype.hide=function(){$.issueMenu.Box.style.display="none"},$.bullet=function(e,t,a,n,i,s,o,l){this.target=i,this.damage=s,this.targetedWeapon=o,this.x=e,this.y=t,this.velocity=4,this.targetX=a+150*Math.random()-75,this.targetY=n+150*Math.random()-75,this.elementType=l;var r=this.x-this.targetX,p=this.y-this.targetY;this.direction=Math.atan2(r,p)},$.bullet.prototype.update=function(e){this.x+=Math.sin(Math.PI+this.direction)*this.velocity*$.dt,this.y+=Math.cos(Math.PI+this.direction)*this.velocity*$.dt;var t=this.x-this.targetX,a=this.y-this.targetY,n=Math.atan2(t,a);$.effects.push(new $.particles(this.x,this.y,t,a,$.elementColors[this.elementType])),Math.floor(n)!=Math.floor(this.direction)&&this.damage>0?($.bullets.splice(e,1),$.effects.push(new $.explosion(this.x,this.y,this.targetX,this.targetY,Math.round(-this.damage))),this.target.receiveDamage(this.targetedWeapon,this.damage)):this.x<=$.W&&this.y<=$.H||this.x>=0&&this.y>=0||$.bullets.splice(e,1)},$.bullet.prototype.render=function(){$.mg1ctx.fillStyle="rgb(255,255,255)",$.mg1ctx.fillRect(this.x,this.y,5,5)},$.weaponButton=function(e,t,a){this.x=e,this.y=t,this.owner=a,this.opacity=1},$.weaponButton.prototype.update=function(e){this.opacity=""!=this.owner.elementType?this.owner.health<=0?0:this.owner.fireRateTick/this.owner.fireRate:0,1==this.owner.isCpu&&"fight"!=$.gameState&&$.weaponButtons.splice(e,1)},$.weaponButton.prototype.render=function(){$.guictx.beginPath(),$.guictx.arc(this.x,this.y,10,0,2*Math.PI,!0),$.guictx.fillStyle="rgba(0,0,0,"+this.opacity+")",""!=this.owner.elementType&&($.guictx.fillStyle="rgba("+$.elementColors[this.owner.elementType].r+" ,"+$.elementColors[this.owner.elementType].g+" ,"+$.elementColors[this.owner.elementType].b+","+this.opacity+")"),$.guictx.fill(),$.guictx.lineWidth=2,$.guictx.strokeStyle="rgba(84,84,84,1.0)",$.guictx.stroke(),this.owner.health<=0&&""!=this.owner.elementType&&($.guictx.fillStyle="rgb(84,84,84)",$.guictx.font="20px Verdana",$.guictx.fillText("X",this.x-7,this.y+7.25))},$.elements=["water","air","fire"],$.elementColors={water:{r:200,g:0,b:255},air:{r:255,g:255,b:255},fire:{r:255,g:0,b:0}},$.story=["The universe has changed.  Galaxies have died, suns have exploded.  Our sun is the last one standing.","In response to the dying universe, planets have broken their orbit and are being drawn to our sun, no matter the distance.  These planets are adapting so their inhabitants can survive.","Unfortunately for earth these planets all want our position in the suns orbit.","Your earth has begun to build weapons to destroy these rouge infringing planets.  Now it's your mission to keep it alive.  How many years can you survive?"],$.explosion=function(e,t,a,n,s){this.x=e,this.y=t,this.velocity=1,this.damage=s,this.life=200,this.lifeTick=0,this.peices=[];var o=this.x-a,l=this.y-n,r=Math.atan2(o,l);for(i=0;100>i;i++)this.peices.push({x:this.x,y:this.y,dir:Math.random()*(r-(r-.4))+(r-.4),vel:Math.random()*this.velocity,size:3*Math.random(),opacity:.5*(10*Math.random()+1)})},$.explosion.prototype.update=function(e){for(x=this.peices.length;x--;)this.peices[x].x+=Math.sin(Math.PI+this.peices[x].dir)*this.peices[x].vel*$.dt,this.peices[x].y+=Math.cos(Math.PI+this.peices[x].dir)*this.peices[x].vel*$.dt;this.lifeTick+=$.dt,this.lifeTick>this.life&&$.effects.splice(e,1)},$.explosion.prototype.render=function(){for(i=this.peices.length;i--;)$.mg1ctx.fillStyle="rgba(255,255,255, "+this.peices[i].opacity*(.9-this.lifeTick/this.life)+")",$.mg1ctx.fillRect(this.peices[i].x,this.peices[i].y,this.peices[i].size,this.peices[i].size);$.mg1ctx.font="16px Verdana",$.mg1ctx.fillText(this.damage,this.x,this.y)},$.planetExplosion=function(e,t,a){for(this.x=e,this.y=t,this.velocity=10*$.dt,this.life=1500,this.lifeTick=0,this.peices=[],i=0;1e3>i;i++)this.peices.push({x:this.x,y:this.y,dir:2*Math.random()*Math.PI,vel:Math.random()*this.velocity,size:30*Math.random()*(a||1),opacity:.5*(10*Math.random()+1)})},$.planetExplosion.prototype.update=function(e){for(x=this.peices.length;x--;)this.peices[x].x+=Math.sin(Math.PI+this.peices[x].dir)*this.peices[x].vel*$.dt,this.peices[x].y+=Math.cos(Math.PI+this.peices[x].dir)*this.peices[x].vel*$.dt;this.lifeTick+=$.dt,this.lifeTick>this.life&&$.effects.splice(e,1)},$.planetExplosion.prototype.render=function(){for(i=this.peices.length;i--;)$.mg1ctx.fillStyle="rgba(255,255,255, "+this.peices[i].opacity*(.9-this.lifeTick/this.life)+")",$.mg1ctx.fillRect(this.peices[i].x,this.peices[i].y,this.peices[i].size,this.peices[i].size)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){setInterval(e,60)}}(),$.setup=function(){$.message=document.getElementById("message"),$.bg1=document.getElementById("bg1"),$.mg1=document.getElementById("mg1"),$.fg1=document.getElementById("fg1"),$.gui=document.getElementById("gui"),$.loseMenu=document.getElementById("Lose-message"),$.weaponStats=document.getElementById("weapon-stats"),$.earthStats=document.getElementById("earth-stats"),$.bg1ctx=$.bg1.getContext("2d"),$.mg1ctx=$.mg1.getContext("2d"),$.fg1ctx=$.fg1.getContext("2d"),$.guictx=$.gui.getContext("2d");var e=1366,t=768;$.bg1.width=Math.max(e,window.innerWidth),$.bg1.height=Math.max(t,window.innerHeight),$.mg1.width=Math.max(e,window.innerWidth),$.mg1.height=Math.max(t,window.innerHeight),$.fg1.width=Math.max(e,window.innerWidth),$.fg1.height=Math.max(t,window.innerHeight),$.gui.width=Math.max(e,window.innerWidth),$.gui.height=Math.max(t,window.innerHeight),$.W=Math.max(e,window.innerWidth),$.H=Math.max(t,window.innerHeight),$.weaponButtons=[],$.effects=[],$.bullets=[],$.updateDelta(),$.createStarsBackground(),$.day=0,$.elapsed=0,$.currentStage=-1,$.player=new $.planet($.W/2-200,$.H/2+100,!1),$.weaponDisplay=new $.weaponMenu,$.weaponDisplay.hide(),$.destinyDisplay=new $.destinyMenu,$.destinyDisplay.hide(),$.loseMenu.style.display="none",$.planetDisplay=new $.planetMenu,$.planetDisplay.hide(),$.issueDisplay=new $.issueMenu,$.issueDisplay.hide(),$.gameSave=new $.gameLoad,$.loop()},$.updateDelta=function(){var e=Date.now();$.dt=(e-$.lt)/(1e3/60),$.dt=$.dt<0?.001:$.dt,$.dt=$.dt>10?10:$.dt,$.lt=e,$.elapsed+=$.dt},$.setDay=function(){$.guictx.fillStyle="rgb(255,255,255)",$.guictx.font="36px Verdana",$.day=Math.floor($.elapsed/400),$.guictx.fillText("Year "+$.day,$.W-200,$.H-20)},$.createEnemyGUI=function(){$.guictx.fillStyle="rgba(255,255,255,0.7)",$.guictx.fillRect($.W-440,58,5,20),$.guictx.fillRect($.W-100,58,5,20),$.guictx.fillRect($.W-430,60,325*$.enemy.health().percent,15),$.guictx.fillStyle="rgb(0,0,0)",$.guictx.font="16px Verdana",$.guictx.fillText("Enemy Planet",$.W-428,73)},$.createPlayerGUI=function(){$.guictx.fillStyle="rgba(255,255,255,0.7)",$.guictx.fillRect(10,18,5,20),$.guictx.fillRect(425,18,5,20),$.guictx.fillRect(20,20,400*$.player.health().percent,15),$.guictx.fillStyle="rgb(0,0,0)",$.guictx.font="16px Verdana",$.guictx.fillText("Health",25,33),$.guictx.fillStyle="rgba("+$.elementColors.water.r+" ,"+$.elementColors.water.g+","+$.elementColors.water.b+",0.7)",$.guictx.fillRect(20,45,$.player.elements.water,15),$.guictx.fillStyle="rgb(0,0,0)",$.guictx.font="16px Verdana",$.guictx.fillText("Water",25,58),$.guictx.fillStyle="rgba("+$.elementColors.fire.r+" ,"+$.elementColors.fire.g+","+$.elementColors.fire.b+",0.7)",$.guictx.fillRect(20,70,$.player.elements.fire,15),$.guictx.fillStyle="rgb(0,0,0)",$.guictx.font="16px Verdana",$.guictx.fillText("Fire",25,83),$.guictx.fillStyle="rgba("+$.elementColors.air.r+" ,"+$.elementColors.air.g+","+$.elementColors.air.b+",0.7)",$.guictx.fillRect(20,95,$.player.elements.air,15),$.guictx.fillStyle="rgb(0,0,0)",$.guictx.font="16px Verdana",$.guictx.fillText("Air",25,108);for(var e=$.weaponButtons.length;e--;)$.weaponButtons[e].update(e);for(e=$.weaponButtons.length;e--;)$.weaponButtons[e].render(e)},$.newBattle=function(){$.fg1ctx.clearRect(0,0,$.W,$.H),$.mg1ctx.clearRect(0,0,$.W,$.H),$.currentStage+=1,$.enemy=null,$.enemy=new $.planet($.W-257,250,!0),$.createEnemyGUI(),$.player.render(),$.enemy.render(),$.player.target=$.enemy,$.enemy.target=$.player,$.gameState="fight"},$.peace=function(){$.fg1ctx.clearRect(0,0,$.W,$.H),$.mg1ctx.clearRect(0,0,$.W,$.H),$.bullets=[],$.enemy=null,$.player.render(),$.player.target=null,$.gameState="peace"},$.postBattle=function(){$.fg1ctx.clearRect(0,0,$.W,$.H),$.mg1ctx.clearRect(0,0,$.W,$.H),$.player.render(),$.destinyDisplay.show(),$.gameState="postBattle"},$.createStarsBackground=function(){for(i=0;5e3>i;i++){var e=Math.random()*$.W,t=Math.random()*$.H,a=.1*(10*Math.random()+1);$.bg1ctx.fillStyle="rgba(255,255,255,"+a+")",$.bg1ctx.fillRect(e,t,1,1)}},$.saveGame=function(){$.effects.push(new $.textTransition(document.getElementById("savedMessage"),100,100,[".....game saved!"])),$.gameSave.save({color1:$.player.color1,color2:$.player.color2,weapons:$.player.weapons,population:$.player.population,elementsPopulation:$.player.elementsPopulation,weaponSlots:$.player.weaponSlots},$.elapsed,$.currentStage)},$.loadGame=function(){$.player=new $.planet($.W/2-200,$.H/2+100,!1),$.player.population=$.gameSave.data.player.population,$.player.elementsPopulation=$.gameSave.data.player.elementsPopulation,$.player.color1=$.gameSave.data.player.color1,$.player.color2=$.gameSave.data.player.color2,$.player.weaponSlots=$.gameSave.data.player.weaponSlots,$.player.weapons=[];for(var e=$.gameSave.data.player.weapons.length;e--;)$.player.weapons.push(new $.weapon(!1,$.gameSave.data.player.weapons[e]));$.weaponButtons=[];for(var t,a=0;a<$.player.weaponSlots;)t=a<$.player.weapons.length?$.player.weapons[a]:{health:0,isCpu:!1,elementType:""},$.weaponButtons.push(new $.weaponButton(30*(a+1),160,t)),a++;$.currentStage=$.gameSave.data.currentStage,$.elapsed=$.gameSave.data.elapsedTime},$.loop=function(){if(requestAnimFrame($.loop),"fight"==$.gameState){$.updateDelta(),$.guictx.clearRect(0,0,$.W,$.H),$.createPlayerGUI(),$.createEnemyGUI(),$.player.update(),$.enemy.update();for(var e=$.effects.length;e--;)$.effects[e].update(e);for(e=$.bullets.length;e--;)$.bullets[e].update(e);for($.mg1ctx.clearRect(0,0,$.W,$.H),e=$.effects.length;e--;)$.effects[e].render();for(e=$.bullets.length;e--;)$.bullets[e].render();$.setDay()}else if("peace"==$.gameState){$.updateDelta(),$.guictx.clearRect(0,0,$.W,$.H),$.mg1ctx.clearRect(0,0,$.W,$.H),$.player.update(),$.createPlayerGUI(),$.setDay();for(var e=$.effects.length;e--;)$.effects[e].update(e);for(e=$.effects.length;e--;)$.effects[e].render();1==Math.floor(Math.random()*(500/$.dt))&&($.gameState="fight",$.newBattle())}else if("postBattle"==$.gameState){$.player.update();for(var e=$.effects.length;e--;)$.effects[e].update(e);for(e=$.bullets.length;e--;)$.bullets[e].update(e);for($.mg1ctx.clearRect(0,0,$.W,$.H),e=$.effects.length;e--;)$.effects[e].render();for(e=$.bullets.length;e--;)$.bullets[e].render()}else if("title"==$.gameState){$.updateDelta();for(var e=$.effects.length;e--;)$.effects[e].update(e);for($.mg1ctx.clearRect(0,0,$.W,$.H),e=$.effects.length;e--;)$.effects[e].render()}},$.play_Click=function(e){var t=document.getElementById("main-menu");$.elapsed=0,e&&$.loadGame(),t.style.display="none",$.peace(),$.earthStats.style.display="block",$.weaponStats.style.display="block",$.weaponDisplay.show(),$.planetDisplay.show(),$.effects=[],$.textTransition.text.style.display="none"},window.addEventListener("load",function(){var e=document.getElementById("resumeGame");$.setup(),$.gameState="title",$.gameSave.isEmpty()&&(e.style.display="none"),$.effects.push(new $.textTransition(document.getElementById("story"),100,100,$.story))}),$.gameLoad=function(){this.data={},this.data.elapsedTime=0,this.data.currentStage=0,this.data.player=null;var e=JSON.parse(localStorage.getItem("progress"));null==e?localStorage.setItem("progress",JSON.stringify(this.data)):(this.data.currentStage=e.currentStage,this.data.elapsedTime=e.elapsedTime,this.data.player=e.player)},$.gameLoad.prototype.save=function(e,t,a){this.data.currentStage=a,this.data.elapsedTime=t,this.data.player=e,localStorage.setItem("progress",JSON.stringify(this.data))},$.gameLoad.prototype.isEmpty=function(){return null==this.data.player?!0:!1},$.particles=function(e,t,a,n,s){this.x=e,this.y=t,this.velocity=1,this.life=40,this.lifeTick=0,this.peices=[],this.color=s;var o=this.x-a,l=this.y-n,r=Math.atan2(o,l);for(i=0;2>i;i++)this.peices.push({x:this.x,y:this.y,dir:Math.random()*(r-(r-.4))+(r-.4),vel:Math.random()*this.velocity,size:3*Math.random(),opacity:.5*(10*Math.random()+1)})},$.particles.prototype.update=function(e){for(x=this.peices.length;x--;)this.peices[x].x+=Math.sin(Math.PI+this.peices[x].dir)*this.peices[x].vel*$.dt,this.peices[x].y+=Math.cos(Math.PI+this.peices[x].dir)*this.peices[x].vel*$.dt;this.lifeTick+=$.dt,this.lifeTick>this.life&&$.effects.splice(e,1)},$.particles.prototype.render=function(){for(i=this.peices.length;i--;){{1-this.life/this.lifeTick}$.mg1ctx.fillStyle="rgba("+this.color.r+","+this.color.g+","+this.color.b+", "+this.peices[i].opacity*(.9-this.lifeTick/this.life)+")",$.mg1ctx.fillRect(this.peices[i].x,this.peices[i].y,this.peices[i].size,this.peices[i].size)}},$.planet=function(e,t,a){if(this.isCpu=a||!1,this.waterMax=100,this.fireMax=100,this.airMax=100,this.elements={water:this.waterMax,fire:this.fireMax,air:this.airMax},this.elementsPopulation={water:25,fire:25,air:25,health:25},this.radius=200,this.status=!0,this.weaponSlots=4,this.population=3245,this.target,this.x=e,this.y=t,this.color1=Math.floor(360*Math.random()),this.color2=Math.floor(360*Math.random()),this.weapons=[],a){this.population=Math.floor(3e3*Math.random()*($.currentStage+1)),this.weaponSlots=Math.min(Math.floor(Math.random()*$.currentStage+1),10);{var n=Math.floor(Math.random()*this.weaponSlots)+1;this.weaponSlots}this.createWeapons(this.weaponSlots,n)}else this.createWeapons(this.weaponSlots,2)},$.planet.prototype.updatePopulationAlignment=function(e,t,a){this.elementsPopulation.water+this.elementsPopulation.fire+this.elementsPopulation.air+this.elementsPopulation.health+a<=100&&this.elementsPopulation.water+this.elementsPopulation.fire+this.elementsPopulation.air+this.elementsPopulation.health+a>=0&&t>=0&&(this.elementsPopulation[e]=t)},$.planet.prototype.regenResources=function(){if("postBattle"!=$.gameState){var e=1e4/$.dt,t=2e4/$.dt;this.elements.water=Math.min(this.elements.water+.01*this.elementsPopulation.water*this.population/e,this.waterMax),this.elements.fire=Math.min(this.elements.fire+.01*this.elementsPopulation.fire*this.population/e,this.fireMax),this.elements.air=Math.min(this.elements.air+.01*this.elementsPopulation.air*this.population/e,this.airMax);for(var a=this.weapons.length,n=this.elementsPopulation.health/a;a--;)(this.weapons[a].health>0||"fight"!=$.gameState)&&(this.weapons[a].health=Math.min(this.weapons[a].health+.01*n*this.population/t,this.weapons[a].maxHealth))}},$.planet.prototype.health=function(){for(var e=0,t=0,a=this.weapons.length;a--;)e+=this.weapons[a].health,t+=this.weapons[a].maxHealth;return{current:e,max:t,percent:0>e/t?0:e/t}},$.planet.prototype.receiveDamage=function(e,t){e.health=Math.max(e.health-t,0)},$.planet.prototype.update=function(){this.regenResources();for(var e=this.analyzeEnemy(),t=this.weapons.length;t--;)this.weapons[t].health>0&&(this.weapons[t].fireRateTick+=$.dt,e.length>0&&this.weapons[t].fireRateTick>this.weapons[t].fireRate&&this.elements[this.weapons[t].elementType]>=this.weapons[t].elementCost&&(this.weapons[t].fireRateTick=0,this.elements[this.weapons[t].elementType]-=this.weapons[t].elementCost,$.bullets.push(new $.bullet(this.x,this.y,this.target.x,this.target.y,this.target,1==this.weapons[t].hit()?this.weapons[t].damage:0,e[0],this.weapons[t].elementType))));var a=this.weapons.filter(function(e){return e.health>0});0==a.length&&1==this.status&&(this.status=!1,0==this.isCpu?($.effects.push(new $.planetExplosion(this.x,this.y)),$.loseMenu.style.display="block"):1==this.isCpu&&$.postBattle()),0==this.status&&this.radius>0&&(this.radius-=5,this.render())},$.planet.prototype.analyzeEnemy=function(){var e=[];return null!=this.target&&(e=this.target.weapons.filter(function(e){return e.health>0})),e},$.planet.prototype.declarePeace=function(){var e=Math.floor(Math.random()*this.target.population);this.population+=e,$.effects.push(new $.textParticle(275,$.H-50,"+"+e))},$.planet.prototype.destroyPlanet=function(){$.effects.push(new $.planetExplosion(this.target.x,this.target.y,.2));var e=Math.floor(Math.random()*this.target.weapons.length);if(this.weapons.length<this.weaponSlots){this.target.weapons[0].health=1,this.target.weapons[0].isCpu=!1,this.weapons.push(this.target.weapons[e]),$.weaponDisplay.show(this.weapons,this.weapons.length),$.weaponButtons=[];for(var t,a=0;a<this.weaponSlots;)t=a<this.weapons.length?this.weapons[a]:{health:0,isCpu:!1,elementType:""},$.weaponButtons.push(new $.weaponButton(30*(a+1),160,t)),a++;return!0}return $.weaponDisplay.show(this.weapons,this.weapons.length,this.target.weapons[e]),!1},$.planet.prototype.takeoverPlanet=function(){$.fg1ctx.clearRect(0,0,$.W,$.H);var e,t={};for(e in this.target)t[e]=this.target[e];t.isCpu=!1,t.status=!0,t.x=$.W/2-200,t.y=$.H/2+100,$.weaponButtons=[];for(var a,n=0;n<t.weaponSlots;)n<t.weapons.length?(a=t.weapons[n],t.weapons[n].isCpu=!1,t.weapons[n].health=t.weapons[n].maxHealth/2):a={health:0,isCpu:this.isCpu,elementType:""},$.weaponButtons.push(new $.weaponButton(30*(n+1),160,a)),n++;$.player=t,$.planetDisplay.show(),$.weaponDisplay.show()},$.planet.prototype.createWeapons=function(e,t){for(var a=null,n=this.isCpu?$.W-435:0,i=this.isCpu?100:160,s=0;e>s;)a=null,t>0?(a=new $.weapon(this.isCpu),this.weapons.push(a),t--):a={health:0,isCpu:this.isCpu,elementType:""},$.weaponButtons.push(new $.weaponButton(n+30*(s+1),i,a)),s++},$.planet.prototype.render=function(){$.fg1ctx.beginPath();var e="hsl("+this.color1+",90%,50%)",t="hsl("+this.color2+",100%,10%)",a=$.fg1ctx.createRadialGradient(this.x,this.y,5,this.x,this.y,this.isCpu?100:200);a.addColorStop(0,e),a.addColorStop(1,t),$.fg1ctx.fillStyle=a,$.fg1ctx.shadowBlur=200,$.fg1ctx.shadowColor="rgba(65, 157, 217, 0.9)",$.fg1ctx.arc(this.x,this.y,this.isCpu?this.radius-100:this.radius,0,2*Math.PI,!0),$.fg1ctx.fill(),1==this.status&&($.fg1ctx.shadowColor="rgba(65, 157, 217, 0.0)",$.fg1ctx.fillStyle="rgb(255,255,255)",$.fg1ctx.font=this.isCpu?"26px Verdana":"46px Verdana",$.fg1ctx.fillText("Population "+this.population,this.isCpu?$.W-375:15,this.isCpu?400:$.H-20))},$.textParticle=function(e,t,a){this.x=e,this.y=t,this.velocity=1,this.text=a,this.life=200,this.lifeTick=0},$.textParticle.prototype.update=function(e){this.y-=this.velocity*$.dt,this.lifeTick+=$.dt,this.lifeTick>this.life&&$.effects.splice(e,1)},$.textParticle.prototype.render=function(){$.mg1ctx.fillStyle="rgba(0,255,255, "+1*(.9-this.lifeTick/this.life)+")",$.mg1ctx.font="36px Verdana",$.mg1ctx.fillText(this.text,this.x,this.y)},$.textTransition=function(e,t,a,n){$.textTransition.text=e,this.x=t,this.y=a,this.text=n,this.life=600,this.lifeTick=0,this.current=0,$.textTransition.text.innerText=this.text[this.current],$.textTransition.text.style.display=""},$.textTransition.prototype.update=function(e){this.lifeTick+=$.dt,this.lifeTick>this.life&&(this.lifeTick=0,this.text.length-1==this.current?($.effects.splice(e,1),$.textTransition.text.style.display="none"):(this.current+=1,$.textTransition.text.innerText=this.text[this.current],$.textTransition.text.style.opacity=1))},$.textTransition.prototype.render=function(){$.textTransition.text.style.opacity=1*(.9-this.lifeTick/this.life)},$.weapon=function(e,t){var a=500,n=20+2*($.currentStage+2),i=Math.random()*a;this.isCpu=e||!1,this.maxHealth=null!=t?t.maxHealth:Math.random()*(600+16*($.currentStage+2)),this.health=null!=t?t.health:this.maxHealth,this.fireRateTick=0,this.fireRate=i,this.damage=null!=t?t.damage:Math.random()*n*(i/a)*10+1,this.accuracy=null!=t?t.accuracy:Math.min(.3*Math.random()+.7,.99),this.elementCost=null!=t?t.elementCost:Math.floor(100*Math.random()),this.elementType=null!=t?t.elementType:$.elements[Math.floor(Math.random()*$.elements.length)]},$.weapon.prototype.hit=function(){var e=1*Math.random();return e<this.accuracy},$.weapon.prototype.reset=function(){this.health=this.maxHealth};</script>
<canvas id="bg1"></canvas><canvas id="fg1"></canvas><canvas id="mg1"></canvas><canvas id="gui"></canvas><button id='earth-stats' style="position: absolute; left:430px; top:18px; display:none;" onclick="$.planetDisplay.show();">planet options</button><button id='weapon-stats' class='longerButton' style="position: absolute; left:15px; top:120px; display:none;" onclick="$.weaponDisplay.show();">your weapons</button><div id="weaponDisplay" class="weapon-box"><button class="close-tab weapon-name" onclick="$.weaponDisplay.hide();">X</button><div class="info"><div class="weapon-name">Weapon Slot <div id="wSlot" class="sLine">1</div></div><div class="weapon-details-titles">Damage: <div id="wDamage" class="sLine w-dets-numbers">100</div></div><div class="weapon-details-titles">Health: <div id="wHealth" class="sLine w-dets-numbers">50</div></div><div class="weapon-details-titles">Fire Rate: <div id="wFireRate" class="sLine w-dets-numbers">1s</div></div><div class="weapon-details-titles">Accuracy: <div id="wAccuracy" class="sLine w-dets-numbers">10%</div></div><div class="weapon-details-titles">Element: <div id="wElement" class="sLine w-dets-numbers">Water</div></div><div class="weapon-details-titles">Element Cost: <div id="wEleCost" class="sLine w-dets-numbers">33</div></div><button id="wReplace" class='longerButton' onclick="$.weaponDisplay.delete();">Replace</button></div><button id="wPrev" class="previous-tab weapon-name" onclick="$.weaponDisplay.ClickPrevNext(-1);">prev</button><button id="wNext" class="next-tab weapon-name" onclick="$.weaponDisplay.ClickPrevNext(1);">next</button></div><div id="planetDisplay" class="weapon-box"><button class="close-tab weapon-name" onclick="$.planetDisplay.hide();">X</button><div class="info"><div class="weapon-name">Your Planet</div><div class="weapon-details-titles">Total Weapon Slots: <div id="pSlots" class="sLine w-dets-numbers">5 </div></div><div class="weapon-details-titles">Open Weapon Slots: <div id="pOpenSlots" class="sLine w-dets-numbers">6 </div></div><div class="choiceTitle">Population Allocation</div><div class="weapon-details-titles">health: <div id='healthpercent' class="sLine w-dets-numbers"></div><div id="pHealthRegen" class="sLine w-dets-numbers"><input type="range" onchange="$.planetDisplay.updatePercents(this);" id="health" value="90"></div></div><div class="weapon-details-titles">Water: <div id='waterpercent' class="sLine w-dets-numbers"></div><div id="pWaterRegen" class="sLine w-dets-numbers"><input type="range" onchange="$.planetDisplay.updatePercents(this);" id="water" value="90"></div></div><div class="weapon-details-titles">Fire: <div id='firepercent' class="sLine w-dets-numbers"></div><div id="pFireRegen" class="sLine w-dets-numbers"><input type="range" onchange="$.planetDisplay.updatePercents(this);" id="fire" value="90"></div></div><div class="weapon-details-titles">Air: <div id='airpercent' class="sLine w-dets-numbers"></div><div id="pAirRegen" class="sLine w-dets-numbers"><input type="range" id="air" onchange="$.planetDisplay.updatePercents(this);" value="90"></div></div><div class="w-dets-pop"><div id='populationpercent' class="sLine w-dets-pop"></div> of <div id="pPopulation" class="sLine w-dets-pop">3333</div> people allocated</div><button onclick="$.saveGame();">save game</button><div id="savedMessage"></div></div></div><div id="destinyDisplay"><div class="destinyinfo"><div class="weapon-name">Choose Their Destiny</div><div class="destiny-details inLine"><p class="w-dets-numbers">Destroy<button onclick="$.destinyDisplay.destroyClick();">Choose</button></p><div class="destinyTextHeight">Destroy your enemy, leaving behind a random weapon with 1 health for your arsenal. You will not know what weapon your enemy has left behind until it's in a weapon slot. If you have no open weapon slots, you will be asked to replace one of your current weapons.  Choose wisely or leave your new weapon behind.</div></div><div class="destiny-details inLine"><p class="w-dets-numbers">Peace<button onclick="$.destinyDisplay.peaceClick();">Choose</button></p><div class="destinyTextHeight">Declare peace with your enemy. Leaving them alone to move on.  Doing so will allow some of their popluation to defect over to your planet.  The more people you have, the better your regeneration rates and ability to allocate people to different resources.</div></div><div class="destiny-details inLine"><p class="w-dets-numbers">Takeover<button onclick="$.destinyDisplay.takeoverClick();">Choose</button></p><div class="destinyTextHeight">Leave your planet, weapons, and people behind. Nothing from your old planet will come along except yourself. You will takeover your enemies planet in it's entirety as your own.  Beware, you will only have half life to begin since you just decimated this new planet.</div></div></div></div> <div id='issueMessage' class='weapon-box'> <div class="info weapon-details-titles">You have no open weapon slots.  Choose an existing weapon in your weapon menu to replace or exit the weapon menu to resume without replacing a weapon.</div></div><div id='Lose-message' class='menu-message'>Planet Destroyed<br><button class='bigger' onclick="location.reload();">Restart</button></div><div id='story'></div><div id='main-menu' class='menu-message'>Battleship Earth<br>Simulator<br><button class='bigger' onclick="$.play_Click(false);">New Game</button><button id='resumeGame' class='bigger' onclick="$.play_Click(true);">Resume</button><div id="credits">Created By @Xanmia for JS13KGames 2014<br><br>Big thanks to Xanian7 for ideas<br>and Jack Rugile for code reference/inspiration</div></div></body></html>